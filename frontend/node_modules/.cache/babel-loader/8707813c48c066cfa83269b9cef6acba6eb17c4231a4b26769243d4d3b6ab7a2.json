{"ast":null,"code":"// ---- Globals ----\nconst mapboxgl = window.mapboxgl;\nmapboxgl.accessToken = 'pk.eyJ1IjoiaXNhYWtoYW4iLCJhIjoiY21iejFzMjUzMWlsczJqcXcwa2N4NHdtZSJ9.M7oGg-7sSbbNc0rl3596Jg';\nlet map,\n  currentProvince = 'all',\n  drawControl; // Global variable for draw control\n\nfunction toggleSidebar() {\n  const el = document.getElementById('container');\n  if (el) el.classList.toggle('expanded');\n}\n\n// --- Entry point ---\nfunction initializeMap(styleName = 'satellite-streets-v12') {\n  map = new mapboxgl.Map({\n    container: 'map',\n    style: `mapbox://styles/mapbox/${styleName}`,\n    center: [30, 39],\n    zoom: 6,\n    pitch: 45,\n    bearing: -17.6,\n    antialias: true,\n    projection: 'globe'\n  });\n  map.on('load', () => {\n    addLayersAndSources();\n    initStyleSwitcher();\n\n    // --- FIX: Dynamically load Mapbox Draw, then add the control ---\n    loadDrawDependencies().then(() => {\n      addDrawControl();\n    });\n  });\n  map.once('style.load', initAtmosControls);\n  const origSetStyle = map.setStyle.bind(map);\n  map.setStyle = function (...args) {\n    const ret = origSetStyle(...args);\n    this.once('style.load', () => {\n      addLayersAndSources();\n      rehydrateAtmosphereIfNeeded();\n      initAtmosControls();\n    });\n    return ret;\n  };\n}\n\n// --- NEW: Helper to inject Mapbox Draw scripts if missing ---\nfunction loadDrawDependencies() {\n  return new Promise(resolve => {\n    if (window.MapboxDraw) {\n      resolve();\n      return;\n    }\n    console.log('Injecting Mapbox Draw dependencies...');\n\n    // 1. Inject CSS\n    const cssLink = document.createElement('link');\n    cssLink.rel = 'stylesheet';\n    cssLink.href = 'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css';\n    document.head.appendChild(cssLink);\n\n    // 2. Inject JS\n    const script = document.createElement('script');\n    script.src = 'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js';\n    script.onload = () => {\n      console.log('Mapbox Draw loaded successfully.');\n      resolve();\n    };\n    script.onerror = e => {\n      console.error('Failed to load Mapbox Draw:', e);\n      resolve(); // Resolve anyway so the app doesn't crash\n    };\n    document.head.appendChild(script);\n  });\n}\n\n// --- NEW: Draw Control & Coordinate Storage Logic ---\nfunction addDrawControl() {\n  if (!window.MapboxDraw) {\n    console.warn('MapboxDraw not available even after injection attempt.');\n    return;\n  }\n\n  // Prevent adding duplicate controls if re-initialized\n  if (drawControl) {\n    try {\n      map.removeControl(drawControl);\n    } catch (e) {}\n  }\n  drawControl = new window.MapboxDraw({\n    displayControlsDefault: false,\n    controls: {\n      polygon: true,\n      trash: true\n    },\n    defaultMode: 'simple_select'\n  });\n\n  // CHANGED: Moved from 'top-left' to 'bottom-left'\n  map.addControl(drawControl, 'bottom-left');\n\n  // Listen for draw events\n  map.on('draw.create', updateStoredCoordinates);\n  map.on('draw.update', updateStoredCoordinates);\n  map.on('draw.delete', updateStoredCoordinates);\n}\nfunction updateStoredCoordinates(e) {\n  if (!drawControl) return;\n  const data = drawControl.getAll();\n  if (data.features.length > 0) {\n    // Store coordinates in global window object\n    window.storedPolygon = data.features[0].geometry.coordinates;\n    console.log('Polygon Stored:', window.storedPolygon);\n  } else {\n    window.storedPolygon = null;\n  }\n}\nfunction initStyleSwitcher() {\n  const styleSel = document.getElementById('layer-style');\n  if (!styleSel) return;\n  if (styleSel._wired) return;\n  styleSel._wired = true;\n  styleSel.addEventListener('change', e => {\n    const styleName = e.target.value;\n    const center = map.getCenter();\n    const zoom = map.getZoom();\n    const pitch = map.getPitch();\n    const bearing = map.getBearing();\n    console.log(`Switching map style to: ${styleName}`);\n    map.setStyle(`mapbox://styles/mapbox/${styleName}`);\n    map.once('style.load', () => {\n      addLayersAndSources();\n      rehydrateAtmosphereIfNeeded();\n      initAtmosControls();\n      map.flyTo({\n        center,\n        zoom,\n        pitch,\n        bearing\n      });\n    });\n  });\n}\n\n// ---------------- Sources & Layers ----------------\nfunction addLayersAndSources() {\n  // DEM\n  if (!map.getSource('mapbox-dem')) {\n    map.addSource('mapbox-dem', {\n      type: 'raster-dem',\n      url: 'mapbox://mapbox.terrain-rgb',\n      tileSize: 512,\n      maxzoom: 14\n    });\n    map.setTerrain({\n      source: 'mapbox-dem',\n      exaggeration: 1.5\n    });\n  }\n\n  // Wind farms\n  {\n    const WIND_ICON_DATA = 'data:image/svg+xml;utf8,' + encodeURIComponent(`\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"64\" height=\"64\" viewBox=\"0 0 24 24\">\n          <g fill=\"#0b7\">\n            <circle cx=\"12\" cy=\"12\" r=\"2\"/>\n            <path d=\"M12 2l1.2 7.5L20 9l-6.5 3.2L15 20l-3-5-3 5 1.5-7.8L4 9l6.8-.5L12 2z\"/>\n          </g>\n        </svg>`);\n    const addWindIcon = img => {\n      if (!map.hasImage('windmill-icon')) map.addImage('windmill-icon', img, {\n        pixelRatio: 2\n      });\n      if (!map.getSource('windmills')) {\n        map.addSource('windmills', {\n          type: 'geojson',\n          data: 'windmills_turkey.geojson'\n        });\n        map.addLayer({\n          id: 'windmill-points',\n          type: 'symbol',\n          source: 'windmills',\n          layout: {\n            'icon-image': 'windmill-icon',\n            'icon-size': 0.07,\n            'icon-allow-overlap': true,\n            visibility: 'visible'\n          }\n        });\n        bindClicks('windmill-points', 'wind');\n      }\n    };\n    map.loadImage('/wind-power.png', (e, img) => {\n      if (e || !img) map.loadImage(WIND_ICON_DATA, (e2, img2) => addWindIcon(img2));else addWindIcon(img);\n    });\n  }\n\n  // Solar farms\n  {\n    const SOLAR_ICON_DATA = 'data:image/svg+xml;utf8,' + encodeURIComponent(`\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"64\" height=\"64\" viewBox=\"0 0 24 24\">\n          <g fill=\"#e6a400\">\n            <rect x=\"4\" y=\"10\" width=\"16\" height=\"6\" rx=\"1.2\"/>\n            <path d=\"M6 18h12l-1 2H7z\"/>\n            <circle cx=\"18.5\" cy=\"5.5\" r=\"3.5\"/>\n          </g>\n        </svg>`);\n    const addSolarIcon = img => {\n      if (!map.hasImage('solar-icon')) map.addImage('solar-icon', img, {\n        pixelRatio: 2\n      });\n      if (!map.getSource('solarfarms')) {\n        map.addSource('solarfarms', {\n          type: 'geojson',\n          data: 'solar.geojson'\n        });\n        map.addLayer({\n          id: 'solar-points',\n          type: 'symbol',\n          source: 'solarfarms',\n          layout: {\n            'icon-image': 'solar-icon',\n            'icon-size': 0.07,\n            'icon-allow-overlap': true,\n            visibility: 'visible'\n          }\n        });\n        bindClicks('solar-points', 'solar');\n      }\n    };\n    map.loadImage('/solar.png', (e, img) => {\n      if (e || !img) map.loadImage(SOLAR_ICON_DATA, (e2, img2) => addSolarIcon(img2));else addSolarIcon(img);\n    });\n  }\n\n  // Provinces\n  if (!map.getSource('provinces')) {\n    map.addSource('provinces', {\n      type: 'geojson',\n      data: 'tr-cities.json'\n    });\n    map.addLayer({\n      id: 'province-fill',\n      type: 'fill',\n      source: 'provinces',\n      paint: {\n        'fill-color': '#088',\n        'fill-opacity': 0\n      }\n    });\n    map.addLayer({\n      id: 'province-outline',\n      type: 'line',\n      source: 'provinces',\n      paint: {\n        'line-color': '#000',\n        'line-width': 1\n      }\n    });\n  }\n  populateProvinces();\n  applyProvinceFilter();\n  applyDataTypeFilter();\n}\n\n// ---------------- Popup binding ----------------\nfunction bindClicks(layerId, type) {\n  map.on('click', layerId, e => {\n    var _f$geometry;\n    // If we are currently drawing, don't open popups!\n    if (drawControl && drawControl.getMode() !== 'simple_select') return;\n    const f = e.features && e.features[0];\n    if (!f) return;\n    const c = (_f$geometry = f.geometry) !== null && _f$geometry !== void 0 && _f$geometry.coordinates ? f.geometry.coordinates.slice() : [e.lngLat.lng, e.lngLat.lat];\n    const p = f.properties || {};\n    const esc = v => String(v !== null && v !== void 0 ? v : '').replace(/[&<>\"']/g, s => ({\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#39;'\n    })[s]);\n    const lat = p.Latitude || p.lat || c[1] || e.lngLat.lat;\n    const lon = p.Longitude || p.lon || p.lng || c[0] || e.lngLat.lng;\n    let html = '';\n    if (type === 'wind') {\n      html = `\n        <strong>Name:</strong> ${esc(p.Name)}<br>\n        <strong>Status:</strong> ${esc(p.Status)}<br>\n        <strong>Year:</strong> ${esc(p.Year)}<br>\n        <strong>Province:</strong> ${esc(p.Province)}<br>\n        <button id=\"btn-weather\">View Weather</button>\n        <button id=\"btn-report\">Download Report</button>\n      `;\n    } else {\n      html = `\n        <strong>Project:</strong> ${esc(p.Project)}<br>\n        <strong>Operator:</strong> ${esc(p.Operator)}<br>\n        <strong>Method:</strong> ${esc(p.Method)}<br>\n        <strong>Capacity:</strong> ${esc(p.Capacity)}<br>\n        <strong>Province:</strong> ${esc(p.Province)}<br>\n        <strong>Plant Source:</strong> ${esc(p['plant:source'])}<br>\n        <button id=\"btn-weather\">View Weather</button>\n        <button id=\"btn-report\">Download Report</button>\n      `;\n    }\n    new mapboxgl.Popup().setLngLat(c).setHTML(html).addTo(map);\n    setTimeout(() => {\n      const btnWeather = document.getElementById('btn-weather');\n      const btnReport = document.getElementById('btn-report');\n      if (btnWeather) btnWeather.addEventListener('click', () => openWeatherModal(lat, lon));\n      if (btnReport) {\n        if (type === 'wind') btnReport.addEventListener('click', () => downloadWindReport(lat, lon, p));else btnReport.addEventListener('click', () => downloadSolarReport(lat, lon, p));\n      }\n    }, 100);\n    map.flyTo({\n      center: c,\n      zoom: 17\n    });\n  });\n}\nfunction downloadWindReport(lat, lon, props = {}) {\n  const qs = new URLSearchParams({\n    lat: lat.toFixed(5),\n    lon: lon.toFixed(5),\n    days: 7,\n    site_type: 'wind',\n    rated_power_mw: props['Rated Power'] || props['Capacity'] || 3.6,\n    name: props['Name'] || '',\n    status: props['Status'] || '',\n    year: props['Year'] || props['Start_year'] || '',\n    province: props['Province'] || ''\n  }).toString();\n  window.open(`http://localhost:8000/report.pdf?${qs}`, '_blank');\n}\nfunction downloadSolarReport(lat, lon, props = {}) {\n  const qs = new URLSearchParams({\n    lat: lat.toFixed(5),\n    lon: lon.toFixed(5),\n    days: 7,\n    site_type: 'solar',\n    capacity: props['Capacity'] || '',\n    project: props['Project'] || props['Name'] || '',\n    operator: props['Operator'] || '',\n    province: props['Province'] || '',\n    method: props['Method'] || '',\n    plant_source: props['plant:source'] || '',\n    power: props['Power'] || ''\n  }).toString();\n  window.open(`http://localhost:8000/report.pdf?${qs}`, '_blank');\n}\nfunction openModal(type) {\n  const M = document.getElementById('graphModal'),\n    F = document.getElementById('graphFrame'),\n    T = document.getElementById('modalTitle'),\n    C = M.querySelector('.modal-content'),\n    H = M.querySelector('.modal-header');\n  let url, w, h;\n  if (type === 'scatter') {\n    T.textContent = 'Static Scatter';\n    url = 'http://localhost:8000/scatter';\n    w = 600;\n    h = 600;\n  } else if (type === 'bar') {\n    T.textContent = 'Static Histogram';\n    url = 'http://localhost:8000/bar';\n    w = 600;\n    h = 500;\n  } else {\n    T.textContent = 'Interactive Scatter';\n    url = 'http://localhost:8000/scatter_int';\n    w = window.innerWidth * 0.8;\n    h = window.innerHeight * 0.8;\n  }\n  F.src = url;\n  F.width = w;\n  F.height = h;\n  const hh = H.getBoundingClientRect().height;\n  C.style.width = `${w}px`;\n  C.style.height = `${hh + h}px`;\n  M.style.display = 'flex';\n}\nfunction closeModal() {\n  const M = document.getElementById('graphModal');\n  const F = document.getElementById('graphFrame');\n  if (M) M.style.display = 'none';\n  if (F) F.src = '';\n}\nfunction openInfoModal() {\n  const M = document.getElementById('infoModal');\n  if (M) M.style.display = 'flex';\n}\nfunction closeInfoModal() {\n  const M = document.getElementById('infoModal');\n  if (M) M.style.display = 'none';\n}\n// ---------------- Province filter ----------------\nfunction populateProvinces() {\n  if (populateProvinces.done) return;\n  populateProvinces.done = true;\n  Promise.all([fetch('windmills_turkey.geojson').then(r => r.json()), fetch('solar.geojson').then(r => r.json())]).then(([W, S]) => {\n    const set = new Set();\n    [...W.features, ...S.features].forEach(f => {\n      const props = f.properties || {};\n      const p = props.Province || props.province;\n      if (p) set.add(p);\n    });\n    const sel = document.getElementById('province-select');\n    if (!sel) return;\n    Array.from(set).sort().forEach(p => sel.appendChild(new Option(p, p)));\n    sel.addEventListener('change', e => {\n      currentProvince = e.target.value;\n      applyProvinceFilter();\n    });\n  });\n}\nfunction applyProvinceFilter() {\n  const f = currentProvince === 'all' ? null : ['==', ['get', 'Province'], currentProvince];\n  if (map.getLayer('windmill-points')) map.setFilter('windmill-points', f);\n  if (map.getLayer('solar-points')) map.setFilter('solar-points', f);\n}\n\n// ---------------- Weather Modal ----------------\nfunction openWeatherModal(lat, lon) {\n  const M = document.getElementById('weatherModal'),\n    F = document.getElementById('weatherFrame');\n  if (F) F.src = `/weather.html?lat=${lat}&lon=${lon}`;\n  if (M) M.style.display = 'flex';\n}\nfunction closeWeatherModal() {\n  const M = document.getElementById('weatherModal'),\n    F = document.getElementById('weatherFrame');\n  if (M) M.style.display = 'none';\n  if (F) F.src = '';\n}\n\n// ---------------- Atmosphere Add-On ----------------\nconst TEMP_SOURCE_ID = 'gfs-temperature';\nconst TEMP_LAYER_ID = 'gfs-temperature-layer';\nconst WIND_SOURCE_ID = 'raster-array-source';\nconst WIND_LAYER_ID = 'wind-layer';\nconst RAIN_SOURCE_ID = 'rainviewer';\nconst RAIN_LAYER_ID = 'rainviewer-layer';\nlet _rainFrames = [],\n  _rainIndex = 0,\n  _rainTimer = null,\n  _rainSpeed = 400;\n\n// --- Temperature layer ---\nfunction addTemperatureLayer() {\n  if (!map.getSource(TEMP_SOURCE_ID)) {\n    map.addSource(TEMP_SOURCE_ID, {\n      type: 'raster-array',\n      url: 'mapbox://mapbox.gfs-temperature',\n      tileSize: 256\n    });\n  }\n  if (!map.getLayer(TEMP_LAYER_ID)) {\n    var _map$getStyle$layers$;\n    const under = (_map$getStyle$layers$ = map.getStyle().layers.find(l => /-label$/.test(l.id))) === null || _map$getStyle$layers$ === void 0 ? void 0 : _map$getStyle$layers$.id;\n    map.addLayer({\n      id: TEMP_LAYER_ID,\n      type: 'raster',\n      source: TEMP_SOURCE_ID,\n      'source-layer': '2t',\n      paint: {\n        'raster-color-range': [253, 313],\n        'raster-array-band': '3',\n        'raster-color': ['interpolate', ['linear'], ['raster-value'], 263, '#313695', 268, '#4575b4', 273, '#74add1', 278, '#abd9e9', 283, '#e0f3f8', 288, '#ffffbf', 293, '#fee090', 298, '#fdae61', 303, '#f46d43', 308, '#d73027', 313, '#a50026', 318, '#67001f', 323, '#40001a'],\n        'raster-resampling': 'nearest',\n        'raster-opacity': 0.75\n      }\n    }, under);\n  }\n}\nfunction removeTemperatureLayer() {\n  if (map.getLayer(TEMP_LAYER_ID)) map.removeLayer(TEMP_LAYER_ID);\n  if (map.getSource(TEMP_SOURCE_ID)) map.removeSource(TEMP_SOURCE_ID);\n}\n\n// --- Wind layer ---\nfunction addWindLayer() {\n  if (!map.getSource(WIND_SOURCE_ID)) {\n    map.addSource(WIND_SOURCE_ID, {\n      type: 'raster-array',\n      url: 'mapbox://mapbox.gfs-winds',\n      tileSize: 512\n    });\n  }\n  if (!map.getLayer(WIND_LAYER_ID)) {\n    map.addLayer({\n      id: WIND_LAYER_ID,\n      type: 'raster-particle',\n      source: WIND_SOURCE_ID,\n      'source-layer': '10winds',\n      paint: {\n        'raster-particle-speed-factor': 0.4,\n        'raster-particle-fade-opacity-factor': 0.9,\n        'raster-particle-reset-rate-factor': 0.4,\n        'raster-particle-count': 4000,\n        'raster-particle-max-speed': 40\n      }\n    });\n  }\n}\nfunction removeWindLayer() {\n  if (map.getLayer(WIND_LAYER_ID)) map.removeLayer(WIND_LAYER_ID);\n  if (map.getSource(WIND_SOURCE_ID)) map.removeSource(WIND_SOURCE_ID);\n}\n\n// --- Rain Radar ---\nasync function _fetchRainviewerTimeline() {\n  var _json$radar, _json$radar2, _json$radar2$nowcast;\n  const res = await fetch('https://api.rainviewer.com/public/weather-maps.json');\n  if (!res.ok) throw new Error('RainViewer fetch failed');\n  const json = await res.json();\n  const frames = [...(((_json$radar = json.radar) === null || _json$radar === void 0 ? void 0 : _json$radar.past) || [])];\n  if ((_json$radar2 = json.radar) !== null && _json$radar2 !== void 0 && (_json$radar2$nowcast = _json$radar2.nowcast) !== null && _json$radar2$nowcast !== void 0 && _json$radar2$nowcast.length) frames.push(...json.radar.nowcast);\n  return frames;\n}\nfunction _setRainFrame(frame) {\n  if (!frame) return;\n  const tileUrl = `https://tilecache.rainviewer.com${frame.path}/256/{z}/{x}/{y}/2/1_1.png`;\n  if (!map.getSource(RAIN_SOURCE_ID)) {\n    map.addSource(RAIN_SOURCE_ID, {\n      type: 'raster',\n      tiles: [tileUrl],\n      tileSize: 256\n    });\n  } else {\n    map.getSource(RAIN_SOURCE_ID).tiles = [tileUrl];\n    map.getSource(RAIN_SOURCE_ID).setTiles([tileUrl]);\n  }\n  if (!map.getLayer(RAIN_LAYER_ID)) {\n    var _map$getStyle$layers$2;\n    map.addLayer({\n      id: RAIN_LAYER_ID,\n      type: 'raster',\n      source: RAIN_SOURCE_ID,\n      paint: {\n        'raster-opacity': 0.7\n      }\n    }, (_map$getStyle$layers$2 = map.getStyle().layers.find(l => /-label$/.test(l.id))) === null || _map$getStyle$layers$2 === void 0 ? void 0 : _map$getStyle$layers$2.id);\n  }\n  _updateRainTimestamp(frame.time);\n}\nasync function addRainLayer() {\n  try {\n    _rainFrames = await _fetchRainviewerTimeline();\n    if (!_rainFrames.length) return;\n    _rainIndex = _rainFrames.length - 1;\n    _setRainFrame(_rainFrames[_rainIndex]);\n    startRainAnimation();\n  } catch (e) {\n    console.error(e);\n  }\n}\nfunction startRainAnimation() {\n  stopRainLayer();\n  _rainTimer = setInterval(() => {\n    _rainIndex = (_rainIndex + 1) % _rainFrames.length;\n    _setRainFrame(_rainFrames[_rainIndex]);\n  }, _rainSpeed);\n}\nfunction stopRainLayer() {\n  if (_rainTimer) {\n    clearInterval(_rainTimer);\n    _rainTimer = null;\n  }\n}\nfunction removeRainLayer() {\n  stopRainLayer();\n  if (map.getLayer(RAIN_LAYER_ID)) map.removeLayer(RAIN_LAYER_ID);\n  if (map.getSource(RAIN_SOURCE_ID)) map.removeSource(RAIN_SOURCE_ID);\n}\nfunction _updateRainTimestamp(ts) {\n  let el = document.getElementById('rain-ts');\n  if (!el) {\n    el = document.createElement('div');\n    el.id = 'rain-ts';\n    el.style.cssText = 'position:absolute;bottom:8px;left:12px;padding:4px 8px;background:rgba(0,0,0,.45);color:#fff;border-radius:6px;font:12px system-ui;z-index:1200';\n    document.body.appendChild(el);\n  }\n  const d = new Date(ts * 1000);\n  el.textContent = `Radar: ${d.toLocaleString()}`;\n}\nfunction rehydrateAtmosphereIfNeeded() {\n  const w = document.getElementById('toggle-wind');\n  const t = document.getElementById('toggle-temp');\n  const r = document.getElementById('toggle-rain');\n  if (t !== null && t !== void 0 && t.checked) addTemperatureLayer();\n  if (w !== null && w !== void 0 && w.checked) addWindLayer();\n  if (r !== null && r !== void 0 && r.checked) addRainLayer();\n}\nfunction initAtmosControls() {\n  const id = 'atmos-controls';\n  if (!document.getElementById(id)) {\n    const panel = document.createElement('div');\n    panel.id = id;\n    panel.style.cssText = 'background:#fff;border:1px solid #e9ecef;border-radius:8px;padding:10px;margin-top:10px;box-shadow:0 1px 2px rgba(0,0,0,.05);font:14px/1.4 system-ui,sans-serif';\n    panel.innerHTML = `\n      <div style=\"font-weight:700;margin-bottom:6px\">Atmosphere</div>\n      <label><input id=\"toggle-wind\" type=\"checkbox\"> Wind (particles)</label><br>\n      <label><input id=\"toggle-temp\" type=\"checkbox\"> Temperature (GFS 2m)</label><br>\n      <label><input id=\"toggle-rain\" type=\"checkbox\"> Rain (radar)</label>\n      <div id=\"rain-controls\" style=\"display:none;margin-left:20px;margin-top:4px;font:12px system-ui\">\n        <button id=\"rain-playpause\">⏸ Pause</button>\n        Speed: <input id=\"rain-speed\" type=\"range\" min=\"100\" max=\"1000\" step=\"100\" value=\"400\">\n      </div>`;\n    (document.getElementById('filter') || document.querySelector('.panel') || document.getElementById('sidebar') || document.body).appendChild(panel);\n  }\n  const w = document.getElementById('toggle-wind');\n  const t = document.getElementById('toggle-temp');\n  const r = document.getElementById('toggle-rain');\n  if (w && !w._wired) {\n    w._wired = true;\n    w.addEventListener('change', e => e.target.checked ? addWindLayer() : removeWindLayer());\n  }\n  if (t && !t._wired) {\n    t._wired = true;\n    t.addEventListener('change', e => e.target.checked ? addTemperatureLayer() : removeTemperatureLayer());\n  }\n  if (r && !r._wired) {\n    r._wired = true;\n    r.addEventListener('change', e => {\n      const ctrls = document.getElementById('rain-controls');\n      if (e.target.checked) {\n        ctrls.style.display = 'block';\n        addRainLayer();\n      } else {\n        ctrls.style.display = 'none';\n        removeRainLayer();\n      }\n    });\n  }\n  const playBtn = document.getElementById('rain-playpause');\n  const speedInput = document.getElementById('rain-speed');\n  if (playBtn && !playBtn._wired) {\n    playBtn._wired = true;\n    playBtn.addEventListener('click', () => {\n      if (_rainTimer) {\n        stopRainLayer();\n        playBtn.textContent = '▶️ Play';\n      } else {\n        startRainAnimation();\n        playBtn.textContent = '⏸ Pause';\n      }\n    });\n  }\n  if (speedInput && !speedInput._wired) {\n    speedInput._wired = true;\n    speedInput.addEventListener('input', e => {\n      _rainSpeed = parseInt(e.target.value, 10);\n      if (_rainTimer) startRainAnimation();\n    });\n  }\n}\n\n// ---------------- Data Type Filter ----------------\nconst dataTypeSel = document.getElementById('data-type-select');\nfunction setLayerVisibility(id, show) {\n  if (map.getLayer(id)) map.setLayoutProperty(id, 'visibility', show ? 'visible' : 'none');\n}\nfunction applyDataTypeFilter() {\n  const v = (dataTypeSel === null || dataTypeSel === void 0 ? void 0 : dataTypeSel.value) || 'all';\n  const showWind = v === 'all' || v === 'wind';\n  const showSolar = v === 'all' || v === 'solar';\n  setLayerVisibility('windmill-points', showWind);\n  setLayerVisibility('solar-points', showSolar);\n}\nif (dataTypeSel) dataTypeSel.addEventListener('change', applyDataTypeFilter);\nwindow.openWeatherModal = openWeatherModal;\nwindow.closeWeatherModal = closeWeatherModal;\nwindow.downloadWindReport = downloadWindReport;\nwindow.downloadSolarReport = downloadSolarReport;\nwindow.openModal = openModal;\nwindow.closeModal = closeModal;\nwindow.openInfoModal = openInfoModal;\nwindow.closeInfoModal = closeInfoModal;\nexport { toggleSidebar, initializeMap, addLayersAndSources, populateProvinces, applyProvinceFilter, bindClicks, openModal, closeModal, openWeatherModal, closeWeatherModal, downloadWindReport, downloadSolarReport, applyDataTypeFilter };","map":{"version":3,"names":["mapboxgl","window","accessToken","map","currentProvince","drawControl","toggleSidebar","el","document","getElementById","classList","toggle","initializeMap","styleName","Map","container","style","center","zoom","pitch","bearing","antialias","projection","on","addLayersAndSources","initStyleSwitcher","loadDrawDependencies","then","addDrawControl","once","initAtmosControls","origSetStyle","setStyle","bind","args","ret","rehydrateAtmosphereIfNeeded","Promise","resolve","MapboxDraw","console","log","cssLink","createElement","rel","href","head","appendChild","script","src","onload","onerror","e","error","warn","removeControl","displayControlsDefault","controls","polygon","trash","defaultMode","addControl","updateStoredCoordinates","data","getAll","features","length","storedPolygon","geometry","coordinates","styleSel","_wired","addEventListener","target","value","getCenter","getZoom","getPitch","getBearing","flyTo","getSource","addSource","type","url","tileSize","maxzoom","setTerrain","source","exaggeration","WIND_ICON_DATA","encodeURIComponent","addWindIcon","img","hasImage","addImage","pixelRatio","addLayer","id","layout","visibility","bindClicks","loadImage","e2","img2","SOLAR_ICON_DATA","addSolarIcon","paint","populateProvinces","applyProvinceFilter","applyDataTypeFilter","layerId","_f$geometry","getMode","f","c","slice","lngLat","lng","lat","p","properties","esc","v","String","replace","s","Latitude","lon","Longitude","html","Name","Status","Year","Province","Project","Operator","Method","Capacity","Popup","setLngLat","setHTML","addTo","setTimeout","btnWeather","btnReport","openWeatherModal","downloadWindReport","downloadSolarReport","props","qs","URLSearchParams","toFixed","days","site_type","rated_power_mw","name","status","year","province","toString","open","capacity","project","operator","method","plant_source","power","openModal","M","F","T","C","querySelector","H","w","h","textContent","innerWidth","innerHeight","width","height","hh","getBoundingClientRect","display","closeModal","openInfoModal","closeInfoModal","done","all","fetch","r","json","W","S","set","Set","forEach","add","sel","Array","from","sort","Option","getLayer","setFilter","closeWeatherModal","TEMP_SOURCE_ID","TEMP_LAYER_ID","WIND_SOURCE_ID","WIND_LAYER_ID","RAIN_SOURCE_ID","RAIN_LAYER_ID","_rainFrames","_rainIndex","_rainTimer","_rainSpeed","addTemperatureLayer","_map$getStyle$layers$","under","getStyle","layers","find","l","test","removeTemperatureLayer","removeLayer","removeSource","addWindLayer","removeWindLayer","_fetchRainviewerTimeline","_json$radar","_json$radar2","_json$radar2$nowcast","res","ok","Error","frames","radar","past","nowcast","push","_setRainFrame","frame","tileUrl","path","tiles","setTiles","_map$getStyle$layers$2","_updateRainTimestamp","time","addRainLayer","startRainAnimation","stopRainLayer","setInterval","clearInterval","removeRainLayer","ts","cssText","body","d","Date","toLocaleString","t","checked","panel","innerHTML","ctrls","playBtn","speedInput","parseInt","dataTypeSel","setLayerVisibility","show","setLayoutProperty","showWind","showSolar"],"sources":["/Users/isakhan/Documents/MapboxProject/frontend/src/legacy/indexLegacy.jsx"],"sourcesContent":["// ---- Globals ----\nconst mapboxgl = window.mapboxgl;\n\nmapboxgl.accessToken =\n  'pk.eyJ1IjoiaXNhYWtoYW4iLCJhIjoiY21iejFzMjUzMWlsczJqcXcwa2N4NHdtZSJ9.M7oGg-7sSbbNc0rl3596Jg';\n\nlet map,\n  currentProvince = 'all',\n  drawControl; // Global variable for draw control\n\nfunction toggleSidebar() {\n  const el = document.getElementById('container');\n  if (el) el.classList.toggle('expanded');\n}\n\n// --- Entry point ---\nfunction initializeMap(styleName = 'satellite-streets-v12') {\n  map = new mapboxgl.Map({\n    container: 'map',\n    style: `mapbox://styles/mapbox/${styleName}`,\n    center: [30, 39],\n    zoom: 6,\n    pitch: 45,\n    bearing: -17.6,\n    antialias: true,\n    projection: 'globe',\n  });\n\n  map.on('load', () => {\n    addLayersAndSources();\n    initStyleSwitcher();\n\n    // --- FIX: Dynamically load Mapbox Draw, then add the control ---\n    loadDrawDependencies().then(() => {\n      addDrawControl();\n    });\n  });\n\n  map.once('style.load', initAtmosControls);\n\n  const origSetStyle = map.setStyle.bind(map);\n  map.setStyle = function (...args) {\n    const ret = origSetStyle(...args);\n    this.once('style.load', () => {\n      addLayersAndSources();\n      rehydrateAtmosphereIfNeeded();\n      initAtmosControls();\n    });\n    return ret;\n  };\n}\n\n// --- NEW: Helper to inject Mapbox Draw scripts if missing ---\nfunction loadDrawDependencies() {\n  return new Promise((resolve) => {\n    if (window.MapboxDraw) {\n      resolve();\n      return;\n    }\n\n    console.log('Injecting Mapbox Draw dependencies...');\n\n    // 1. Inject CSS\n    const cssLink = document.createElement('link');\n    cssLink.rel = 'stylesheet';\n    cssLink.href =\n      'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css';\n    document.head.appendChild(cssLink);\n\n    // 2. Inject JS\n    const script = document.createElement('script');\n    script.src =\n      'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js';\n    script.onload = () => {\n      console.log('Mapbox Draw loaded successfully.');\n      resolve();\n    };\n    script.onerror = (e) => {\n      console.error('Failed to load Mapbox Draw:', e);\n      resolve(); // Resolve anyway so the app doesn't crash\n    };\n    document.head.appendChild(script);\n  });\n}\n\n// --- NEW: Draw Control & Coordinate Storage Logic ---\nfunction addDrawControl() {\n  if (!window.MapboxDraw) {\n    console.warn('MapboxDraw not available even after injection attempt.');\n    return;\n  }\n\n  // Prevent adding duplicate controls if re-initialized\n  if (drawControl) {\n    try {\n      map.removeControl(drawControl);\n    } catch (e) {}\n  }\n\n  drawControl = new window.MapboxDraw({\n    displayControlsDefault: false,\n    controls: {\n      polygon: true,\n      trash: true,\n    },\n    defaultMode: 'simple_select',\n  });\n\n  // CHANGED: Moved from 'top-left' to 'bottom-left'\n  map.addControl(drawControl, 'bottom-left');\n\n  // Listen for draw events\n  map.on('draw.create', updateStoredCoordinates);\n  map.on('draw.update', updateStoredCoordinates);\n  map.on('draw.delete', updateStoredCoordinates);\n}\n\nfunction updateStoredCoordinates(e) {\n  if (!drawControl) return;\n  const data = drawControl.getAll();\n  if (data.features.length > 0) {\n    // Store coordinates in global window object\n    window.storedPolygon = data.features[0].geometry.coordinates;\n    console.log('Polygon Stored:', window.storedPolygon);\n  } else {\n    window.storedPolygon = null;\n  }\n}\n\nfunction initStyleSwitcher() {\n  const styleSel = document.getElementById('layer-style');\n  if (!styleSel) return;\n\n  if (styleSel._wired) return;\n  styleSel._wired = true;\n\n  styleSel.addEventListener('change', (e) => {\n    const styleName = e.target.value;\n    const center = map.getCenter();\n    const zoom = map.getZoom();\n    const pitch = map.getPitch();\n    const bearing = map.getBearing();\n\n    console.log(`Switching map style to: ${styleName}`);\n\n    map.setStyle(`mapbox://styles/mapbox/${styleName}`);\n\n    map.once('style.load', () => {\n      addLayersAndSources();\n      rehydrateAtmosphereIfNeeded();\n      initAtmosControls();\n      map.flyTo({ center, zoom, pitch, bearing });\n    });\n  });\n}\n\n// ---------------- Sources & Layers ----------------\nfunction addLayersAndSources() {\n  // DEM\n  if (!map.getSource('mapbox-dem')) {\n    map.addSource('mapbox-dem', {\n      type: 'raster-dem',\n      url: 'mapbox://mapbox.terrain-rgb',\n      tileSize: 512,\n      maxzoom: 14,\n    });\n    map.setTerrain({ source: 'mapbox-dem', exaggeration: 1.5 });\n  }\n\n  // Wind farms\n  {\n    const WIND_ICON_DATA =\n      'data:image/svg+xml;utf8,' +\n      encodeURIComponent(`\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"64\" height=\"64\" viewBox=\"0 0 24 24\">\n          <g fill=\"#0b7\">\n            <circle cx=\"12\" cy=\"12\" r=\"2\"/>\n            <path d=\"M12 2l1.2 7.5L20 9l-6.5 3.2L15 20l-3-5-3 5 1.5-7.8L4 9l6.8-.5L12 2z\"/>\n          </g>\n        </svg>`);\n\n    const addWindIcon = (img) => {\n      if (!map.hasImage('windmill-icon'))\n        map.addImage('windmill-icon', img, { pixelRatio: 2 });\n      if (!map.getSource('windmills')) {\n        map.addSource('windmills', {\n          type: 'geojson',\n          data: 'windmills_turkey.geojson',\n        });\n        map.addLayer({\n          id: 'windmill-points',\n          type: 'symbol',\n          source: 'windmills',\n          layout: {\n            'icon-image': 'windmill-icon',\n            'icon-size': 0.07,\n            'icon-allow-overlap': true,\n            visibility: 'visible',\n          },\n        });\n        bindClicks('windmill-points', 'wind');\n      }\n    };\n\n    map.loadImage('/wind-power.png', (e, img) => {\n      if (e || !img)\n        map.loadImage(WIND_ICON_DATA, (e2, img2) => addWindIcon(img2));\n      else addWindIcon(img);\n    });\n  }\n\n  // Solar farms\n  {\n    const SOLAR_ICON_DATA =\n      'data:image/svg+xml;utf8,' +\n      encodeURIComponent(`\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"64\" height=\"64\" viewBox=\"0 0 24 24\">\n          <g fill=\"#e6a400\">\n            <rect x=\"4\" y=\"10\" width=\"16\" height=\"6\" rx=\"1.2\"/>\n            <path d=\"M6 18h12l-1 2H7z\"/>\n            <circle cx=\"18.5\" cy=\"5.5\" r=\"3.5\"/>\n          </g>\n        </svg>`);\n\n    const addSolarIcon = (img) => {\n      if (!map.hasImage('solar-icon'))\n        map.addImage('solar-icon', img, { pixelRatio: 2 });\n      if (!map.getSource('solarfarms')) {\n        map.addSource('solarfarms', {\n          type: 'geojson',\n          data: 'solar.geojson',\n        });\n        map.addLayer({\n          id: 'solar-points',\n          type: 'symbol',\n          source: 'solarfarms',\n          layout: {\n            'icon-image': 'solar-icon',\n            'icon-size': 0.07,\n            'icon-allow-overlap': true,\n            visibility: 'visible',\n          },\n        });\n        bindClicks('solar-points', 'solar');\n      }\n    };\n\n    map.loadImage('/solar.png', (e, img) => {\n      if (e || !img)\n        map.loadImage(SOLAR_ICON_DATA, (e2, img2) => addSolarIcon(img2));\n      else addSolarIcon(img);\n    });\n  }\n\n  // Provinces\n  if (!map.getSource('provinces')) {\n    map.addSource('provinces', { type: 'geojson', data: 'tr-cities.json' });\n    map.addLayer({\n      id: 'province-fill',\n      type: 'fill',\n      source: 'provinces',\n      paint: { 'fill-color': '#088', 'fill-opacity': 0 },\n    });\n    map.addLayer({\n      id: 'province-outline',\n      type: 'line',\n      source: 'provinces',\n      paint: { 'line-color': '#000', 'line-width': 1 },\n    });\n  }\n\n  populateProvinces();\n  applyProvinceFilter();\n  applyDataTypeFilter();\n}\n\n// ---------------- Popup binding ----------------\nfunction bindClicks(layerId, type) {\n  map.on('click', layerId, (e) => {\n    // If we are currently drawing, don't open popups!\n    if (drawControl && drawControl.getMode() !== 'simple_select') return;\n\n    const f = e.features && e.features[0];\n    if (!f) return;\n\n    const c = f.geometry?.coordinates\n      ? f.geometry.coordinates.slice()\n      : [e.lngLat.lng, e.lngLat.lat];\n    const p = f.properties || {};\n    const esc = (v) =>\n      String(v ?? '').replace(\n        /[&<>\"']/g,\n        (s) =>\n          ({\n            '&': '&amp;',\n            '<': '&lt;',\n            '>': '&gt;',\n            '\"': '&quot;',\n            \"'\": '&#39;',\n          }[s])\n      );\n\n    const lat = p.Latitude || p.lat || c[1] || e.lngLat.lat;\n    const lon = p.Longitude || p.lon || p.lng || c[0] || e.lngLat.lng;\n\n    let html = '';\n    if (type === 'wind') {\n      html = `\n        <strong>Name:</strong> ${esc(p.Name)}<br>\n        <strong>Status:</strong> ${esc(p.Status)}<br>\n        <strong>Year:</strong> ${esc(p.Year)}<br>\n        <strong>Province:</strong> ${esc(p.Province)}<br>\n        <button id=\"btn-weather\">View Weather</button>\n        <button id=\"btn-report\">Download Report</button>\n      `;\n    } else {\n      html = `\n        <strong>Project:</strong> ${esc(p.Project)}<br>\n        <strong>Operator:</strong> ${esc(p.Operator)}<br>\n        <strong>Method:</strong> ${esc(p.Method)}<br>\n        <strong>Capacity:</strong> ${esc(p.Capacity)}<br>\n        <strong>Province:</strong> ${esc(p.Province)}<br>\n        <strong>Plant Source:</strong> ${esc(p['plant:source'])}<br>\n        <button id=\"btn-weather\">View Weather</button>\n        <button id=\"btn-report\">Download Report</button>\n      `;\n    }\n\n    new mapboxgl.Popup().setLngLat(c).setHTML(html).addTo(map);\n\n    setTimeout(() => {\n      const btnWeather = document.getElementById('btn-weather');\n      const btnReport = document.getElementById('btn-report');\n      if (btnWeather)\n        btnWeather.addEventListener('click', () => openWeatherModal(lat, lon));\n      if (btnReport) {\n        if (type === 'wind')\n          btnReport.addEventListener('click', () =>\n            downloadWindReport(lat, lon, p)\n          );\n        else\n          btnReport.addEventListener('click', () =>\n            downloadSolarReport(lat, lon, p)\n          );\n      }\n    }, 100);\n\n    map.flyTo({ center: c, zoom: 17 });\n  });\n}\n\nfunction downloadWindReport(lat, lon, props = {}) {\n  const qs = new URLSearchParams({\n    lat: lat.toFixed(5),\n    lon: lon.toFixed(5),\n    days: 7,\n    site_type: 'wind',\n    rated_power_mw: props['Rated Power'] || props['Capacity'] || 3.6,\n    name: props['Name'] || '',\n    status: props['Status'] || '',\n    year: props['Year'] || props['Start_year'] || '',\n    province: props['Province'] || '',\n  }).toString();\n  window.open(`http://localhost:8000/report.pdf?${qs}`, '_blank');\n}\n\nfunction downloadSolarReport(lat, lon, props = {}) {\n  const qs = new URLSearchParams({\n    lat: lat.toFixed(5),\n    lon: lon.toFixed(5),\n    days: 7,\n    site_type: 'solar',\n    capacity: props['Capacity'] || '',\n    project: props['Project'] || props['Name'] || '',\n    operator: props['Operator'] || '',\n    province: props['Province'] || '',\n    method: props['Method'] || '',\n    plant_source: props['plant:source'] || '',\n    power: props['Power'] || '',\n  }).toString();\n  window.open(`http://localhost:8000/report.pdf?${qs}`, '_blank');\n}\nfunction openModal(type) {\n  const M = document.getElementById('graphModal'),\n    F = document.getElementById('graphFrame'),\n    T = document.getElementById('modalTitle'),\n    C = M.querySelector('.modal-content'),\n    H = M.querySelector('.modal-header');\n  let url, w, h;\n  if (type === 'scatter') {\n    T.textContent = 'Static Scatter';\n    url = 'http://localhost:8000/scatter';\n    w = 600;\n    h = 600;\n  } else if (type === 'bar') {\n    T.textContent = 'Static Histogram';\n    url = 'http://localhost:8000/bar';\n    w = 600;\n    h = 500;\n  } else {\n    T.textContent = 'Interactive Scatter';\n    url = 'http://localhost:8000/scatter_int';\n    w = window.innerWidth * 0.8;\n    h = window.innerHeight * 0.8;\n  }\n  F.src = url;\n  F.width = w;\n  F.height = h;\n  const hh = H.getBoundingClientRect().height;\n  C.style.width = `${w}px`;\n  C.style.height = `${hh + h}px`;\n  M.style.display = 'flex';\n}\nfunction closeModal() {\n  const M = document.getElementById('graphModal');\n  const F = document.getElementById('graphFrame');\n  if (M) M.style.display = 'none';\n  if (F) F.src = '';\n}\nfunction openInfoModal() {\n  const M = document.getElementById('infoModal');\n  if (M) M.style.display = 'flex';\n}\nfunction closeInfoModal() {\n  const M = document.getElementById('infoModal');\n  if (M) M.style.display = 'none';\n}\n// ---------------- Province filter ----------------\nfunction populateProvinces() {\n  if (populateProvinces.done) return;\n  populateProvinces.done = true;\n  Promise.all([\n    fetch('windmills_turkey.geojson').then((r) => r.json()),\n    fetch('solar.geojson').then((r) => r.json()),\n  ]).then(([W, S]) => {\n    const set = new Set();\n    [...W.features, ...S.features].forEach((f) => {\n      const props = f.properties || {};\n      const p = props.Province || props.province;\n      if (p) set.add(p);\n    });\n    const sel = document.getElementById('province-select');\n    if (!sel) return;\n    Array.from(set)\n      .sort()\n      .forEach((p) => sel.appendChild(new Option(p, p)));\n    sel.addEventListener('change', (e) => {\n      currentProvince = e.target.value;\n      applyProvinceFilter();\n    });\n  });\n}\n\nfunction applyProvinceFilter() {\n  const f =\n    currentProvince === 'all'\n      ? null\n      : ['==', ['get', 'Province'], currentProvince];\n  if (map.getLayer('windmill-points')) map.setFilter('windmill-points', f);\n  if (map.getLayer('solar-points')) map.setFilter('solar-points', f);\n}\n\n// ---------------- Weather Modal ----------------\nfunction openWeatherModal(lat, lon) {\n  const M = document.getElementById('weatherModal'),\n    F = document.getElementById('weatherFrame');\n  if (F) F.src = `/weather.html?lat=${lat}&lon=${lon}`;\n  if (M) M.style.display = 'flex';\n}\nfunction closeWeatherModal() {\n  const M = document.getElementById('weatherModal'),\n    F = document.getElementById('weatherFrame');\n  if (M) M.style.display = 'none';\n  if (F) F.src = '';\n}\n\n// ---------------- Atmosphere Add-On ----------------\nconst TEMP_SOURCE_ID = 'gfs-temperature';\nconst TEMP_LAYER_ID = 'gfs-temperature-layer';\nconst WIND_SOURCE_ID = 'raster-array-source';\nconst WIND_LAYER_ID = 'wind-layer';\nconst RAIN_SOURCE_ID = 'rainviewer';\nconst RAIN_LAYER_ID = 'rainviewer-layer';\n\nlet _rainFrames = [],\n  _rainIndex = 0,\n  _rainTimer = null,\n  _rainSpeed = 400;\n\n// --- Temperature layer ---\nfunction addTemperatureLayer() {\n  if (!map.getSource(TEMP_SOURCE_ID)) {\n    map.addSource(TEMP_SOURCE_ID, {\n      type: 'raster-array',\n      url: 'mapbox://mapbox.gfs-temperature',\n      tileSize: 256,\n    });\n  }\n  if (!map.getLayer(TEMP_LAYER_ID)) {\n    const under = map.getStyle().layers.find((l) => /-label$/.test(l.id))?.id;\n    map.addLayer(\n      {\n        id: TEMP_LAYER_ID,\n        type: 'raster',\n        source: TEMP_SOURCE_ID,\n        'source-layer': '2t',\n        paint: {\n          'raster-color-range': [253, 313],\n          'raster-array-band': '3',\n          'raster-color': [\n            'interpolate',\n            ['linear'],\n            ['raster-value'],\n            263,\n            '#313695',\n            268,\n            '#4575b4',\n            273,\n            '#74add1',\n            278,\n            '#abd9e9',\n            283,\n            '#e0f3f8',\n            288,\n            '#ffffbf',\n            293,\n            '#fee090',\n            298,\n            '#fdae61',\n            303,\n            '#f46d43',\n            308,\n            '#d73027',\n            313,\n            '#a50026',\n            318,\n            '#67001f',\n            323,\n            '#40001a',\n          ],\n          'raster-resampling': 'nearest',\n          'raster-opacity': 0.75,\n        },\n      },\n      under\n    );\n  }\n}\nfunction removeTemperatureLayer() {\n  if (map.getLayer(TEMP_LAYER_ID)) map.removeLayer(TEMP_LAYER_ID);\n  if (map.getSource(TEMP_SOURCE_ID)) map.removeSource(TEMP_SOURCE_ID);\n}\n\n// --- Wind layer ---\nfunction addWindLayer() {\n  if (!map.getSource(WIND_SOURCE_ID)) {\n    map.addSource(WIND_SOURCE_ID, {\n      type: 'raster-array',\n      url: 'mapbox://mapbox.gfs-winds',\n      tileSize: 512,\n    });\n  }\n  if (!map.getLayer(WIND_LAYER_ID)) {\n    map.addLayer({\n      id: WIND_LAYER_ID,\n      type: 'raster-particle',\n      source: WIND_SOURCE_ID,\n      'source-layer': '10winds',\n      paint: {\n        'raster-particle-speed-factor': 0.4,\n        'raster-particle-fade-opacity-factor': 0.9,\n        'raster-particle-reset-rate-factor': 0.4,\n        'raster-particle-count': 4000,\n        'raster-particle-max-speed': 40,\n      },\n    });\n  }\n}\nfunction removeWindLayer() {\n  if (map.getLayer(WIND_LAYER_ID)) map.removeLayer(WIND_LAYER_ID);\n  if (map.getSource(WIND_SOURCE_ID)) map.removeSource(WIND_SOURCE_ID);\n}\n\n// --- Rain Radar ---\nasync function _fetchRainviewerTimeline() {\n  const res = await fetch(\n    'https://api.rainviewer.com/public/weather-maps.json'\n  );\n  if (!res.ok) throw new Error('RainViewer fetch failed');\n  const json = await res.json();\n  const frames = [...(json.radar?.past || [])];\n  if (json.radar?.nowcast?.length) frames.push(...json.radar.nowcast);\n  return frames;\n}\nfunction _setRainFrame(frame) {\n  if (!frame) return;\n  const tileUrl = `https://tilecache.rainviewer.com${frame.path}/256/{z}/{x}/{y}/2/1_1.png`;\n  if (!map.getSource(RAIN_SOURCE_ID)) {\n    map.addSource(RAIN_SOURCE_ID, {\n      type: 'raster',\n      tiles: [tileUrl],\n      tileSize: 256,\n    });\n  } else {\n    map.getSource(RAIN_SOURCE_ID).tiles = [tileUrl];\n    map.getSource(RAIN_SOURCE_ID).setTiles([tileUrl]);\n  }\n  if (!map.getLayer(RAIN_LAYER_ID)) {\n    map.addLayer(\n      {\n        id: RAIN_LAYER_ID,\n        type: 'raster',\n        source: RAIN_SOURCE_ID,\n        paint: { 'raster-opacity': 0.7 },\n      },\n      map.getStyle().layers.find((l) => /-label$/.test(l.id))?.id\n    );\n  }\n  _updateRainTimestamp(frame.time);\n}\nasync function addRainLayer() {\n  try {\n    _rainFrames = await _fetchRainviewerTimeline();\n    if (!_rainFrames.length) return;\n    _rainIndex = _rainFrames.length - 1;\n    _setRainFrame(_rainFrames[_rainIndex]);\n    startRainAnimation();\n  } catch (e) {\n    console.error(e);\n  }\n}\nfunction startRainAnimation() {\n  stopRainLayer();\n  _rainTimer = setInterval(() => {\n    _rainIndex = (_rainIndex + 1) % _rainFrames.length;\n    _setRainFrame(_rainFrames[_rainIndex]);\n  }, _rainSpeed);\n}\nfunction stopRainLayer() {\n  if (_rainTimer) {\n    clearInterval(_rainTimer);\n    _rainTimer = null;\n  }\n}\nfunction removeRainLayer() {\n  stopRainLayer();\n  if (map.getLayer(RAIN_LAYER_ID)) map.removeLayer(RAIN_LAYER_ID);\n  if (map.getSource(RAIN_SOURCE_ID)) map.removeSource(RAIN_SOURCE_ID);\n}\nfunction _updateRainTimestamp(ts) {\n  let el = document.getElementById('rain-ts');\n  if (!el) {\n    el = document.createElement('div');\n    el.id = 'rain-ts';\n    el.style.cssText =\n      'position:absolute;bottom:8px;left:12px;padding:4px 8px;background:rgba(0,0,0,.45);color:#fff;border-radius:6px;font:12px system-ui;z-index:1200';\n    document.body.appendChild(el);\n  }\n  const d = new Date(ts * 1000);\n  el.textContent = `Radar: ${d.toLocaleString()}`;\n}\n\nfunction rehydrateAtmosphereIfNeeded() {\n  const w = document.getElementById('toggle-wind');\n  const t = document.getElementById('toggle-temp');\n  const r = document.getElementById('toggle-rain');\n  if (t?.checked) addTemperatureLayer();\n  if (w?.checked) addWindLayer();\n  if (r?.checked) addRainLayer();\n}\n\nfunction initAtmosControls() {\n  const id = 'atmos-controls';\n  if (!document.getElementById(id)) {\n    const panel = document.createElement('div');\n    panel.id = id;\n    panel.style.cssText =\n      'background:#fff;border:1px solid #e9ecef;border-radius:8px;padding:10px;margin-top:10px;box-shadow:0 1px 2px rgba(0,0,0,.05);font:14px/1.4 system-ui,sans-serif';\n    panel.innerHTML = `\n      <div style=\"font-weight:700;margin-bottom:6px\">Atmosphere</div>\n      <label><input id=\"toggle-wind\" type=\"checkbox\"> Wind (particles)</label><br>\n      <label><input id=\"toggle-temp\" type=\"checkbox\"> Temperature (GFS 2m)</label><br>\n      <label><input id=\"toggle-rain\" type=\"checkbox\"> Rain (radar)</label>\n      <div id=\"rain-controls\" style=\"display:none;margin-left:20px;margin-top:4px;font:12px system-ui\">\n        <button id=\"rain-playpause\">⏸ Pause</button>\n        Speed: <input id=\"rain-speed\" type=\"range\" min=\"100\" max=\"1000\" step=\"100\" value=\"400\">\n      </div>`;\n    (\n      document.getElementById('filter') ||\n      document.querySelector('.panel') ||\n      document.getElementById('sidebar') ||\n      document.body\n    ).appendChild(panel);\n  }\n\n  const w = document.getElementById('toggle-wind');\n  const t = document.getElementById('toggle-temp');\n  const r = document.getElementById('toggle-rain');\n  if (w && !w._wired) {\n    w._wired = true;\n    w.addEventListener('change', (e) =>\n      e.target.checked ? addWindLayer() : removeWindLayer()\n    );\n  }\n  if (t && !t._wired) {\n    t._wired = true;\n    t.addEventListener('change', (e) =>\n      e.target.checked ? addTemperatureLayer() : removeTemperatureLayer()\n    );\n  }\n  if (r && !r._wired) {\n    r._wired = true;\n    r.addEventListener('change', (e) => {\n      const ctrls = document.getElementById('rain-controls');\n      if (e.target.checked) {\n        ctrls.style.display = 'block';\n        addRainLayer();\n      } else {\n        ctrls.style.display = 'none';\n        removeRainLayer();\n      }\n    });\n  }\n\n  const playBtn = document.getElementById('rain-playpause');\n  const speedInput = document.getElementById('rain-speed');\n  if (playBtn && !playBtn._wired) {\n    playBtn._wired = true;\n    playBtn.addEventListener('click', () => {\n      if (_rainTimer) {\n        stopRainLayer();\n        playBtn.textContent = '▶️ Play';\n      } else {\n        startRainAnimation();\n        playBtn.textContent = '⏸ Pause';\n      }\n    });\n  }\n  if (speedInput && !speedInput._wired) {\n    speedInput._wired = true;\n    speedInput.addEventListener('input', (e) => {\n      _rainSpeed = parseInt(e.target.value, 10);\n      if (_rainTimer) startRainAnimation();\n    });\n  }\n}\n\n// ---------------- Data Type Filter ----------------\nconst dataTypeSel = document.getElementById('data-type-select');\nfunction setLayerVisibility(id, show) {\n  if (map.getLayer(id))\n    map.setLayoutProperty(id, 'visibility', show ? 'visible' : 'none');\n}\nfunction applyDataTypeFilter() {\n  const v = dataTypeSel?.value || 'all';\n  const showWind = v === 'all' || v === 'wind';\n  const showSolar = v === 'all' || v === 'solar';\n  setLayerVisibility('windmill-points', showWind);\n  setLayerVisibility('solar-points', showSolar);\n}\nif (dataTypeSel) dataTypeSel.addEventListener('change', applyDataTypeFilter);\n\nwindow.openWeatherModal = openWeatherModal;\nwindow.closeWeatherModal = closeWeatherModal;\nwindow.downloadWindReport = downloadWindReport;\nwindow.downloadSolarReport = downloadSolarReport;\n\nwindow.openModal = openModal;\nwindow.closeModal = closeModal;\nwindow.openInfoModal = openInfoModal;\nwindow.closeInfoModal = closeInfoModal;\n\nexport {\n  toggleSidebar,\n  initializeMap,\n  addLayersAndSources,\n  populateProvinces,\n  applyProvinceFilter,\n  bindClicks,\n  openModal,\n  closeModal,\n  openWeatherModal,\n  closeWeatherModal,\n  downloadWindReport,\n  downloadSolarReport,\n  applyDataTypeFilter,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}