{"ast":null,"code":"var _jsxFileName = \"/Users/isakhan/Documents/MapboxProject/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { AuthProvider, useAuth } from './auth/AuthContext';\nimport Login from './components/Login';\nimport SettingsModal from './components/SettingsModal';\nimport './legacy/indexLegacy.css';\n\n/* Root wrapper so auth is global */\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function App() {\n  return /*#__PURE__*/_jsxDEV(AuthProvider, {\n    children: /*#__PURE__*/_jsxDEV(AppInner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 11,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 5\n  }, this);\n}\n_c = App;\nfunction AppInner() {\n  _s();\n  const {\n    currentUser,\n    logout\n  } = useAuth();\n  const [Layout, setLayout] = useState(null);\n  const [settingsOpen, setSettingsOpen] = useState(false);\n\n  // Completely clean the previous Mapbox instance so re-login works without refresh\n  const resetMap = () => {\n    try {\n      if (window.__legacyMapInstance && typeof window.__legacyMapInstance.remove === 'function') {\n        window.__legacyMapInstance.remove();\n      }\n    } catch {}\n    window.__legacyMapInstance = null;\n    window.__legacyMapInit = false;\n    const el = document.getElementById('map');\n    if (el) el.innerHTML = '';\n  };\n  const handleLogout = () => {\n    resetMap();\n    logout();\n  };\n\n  // Role class (hides graph buttons for non-admin via CSS)\n  useEffect(() => {\n    document.body.classList.remove('role-admin', 'role-user');\n    if ((currentUser === null || currentUser === void 0 ? void 0 : currentUser.role) === 'admin') document.body.classList.add('role-admin');\n    if ((currentUser === null || currentUser === void 0 ? void 0 : currentUser.role) === 'user') document.body.classList.add('role-user');\n  }, [currentUser]);\n\n  // Mount/unmount legacy layout around auth changes\n  useEffect(() => {\n    if (!currentUser) {\n      setLayout(null);\n      resetMap();\n      return;\n    }\n    import('./components/LegacyLayout').then(m => setLayout(() => m.default));\n  }, [currentUser]);\n\n  // Initialize the legacy map exactly once per login (StrictMode-safe)\n  useEffect(() => {\n    if (!currentUser || !Layout) return;\n    resetMap(); // ensure clean slate before init\n\n    let tick = setInterval(async () => {\n      if (!window.mapboxgl || !document.getElementById('map')) return;\n\n      // Patch Map constructor once so we can track/remove the live instance\n      if (!window.__mapboxPatchApplied) {\n        const OriginalMap = window.mapboxgl.Map;\n        window.mapboxgl.Map = function (...args) {\n          const inst = new OriginalMap(...args);\n          window.__legacyMapInstance = inst;\n          return inst;\n        };\n        window.mapboxgl.Map.prototype = OriginalMap.prototype;\n        Object.setPrototypeOf(window.mapboxgl.Map, OriginalMap);\n        window.__mapboxPatchApplied = true;\n      }\n      if (window.__legacyMapInit) {\n        clearInterval(tick);\n        return;\n      }\n      const legacy = await import('./legacy/indexLegacy');\n      Object.assign(window, legacy); // expose your original functions\n      window.__legacyMapInit = true; // guard against double init\n      legacy.initializeMap(); // call your original entry point\n      setTimeout(() => window.dispatchEvent(new Event('resize')), 0);\n      clearInterval(tick);\n    }, 50);\n    return () => clearInterval(tick);\n  }, [currentUser, Layout]);\n  if (!currentUser) return /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 28\n  }, this);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      id: \"settingsBtn\",\n      onClick: () => setSettingsOpen(true),\n      children: \"Settings\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      id: \"logoutBtn\",\n      onClick: handleLogout,\n      style: {\n        position: 'fixed',\n        top: 12,\n        right: 112,\n        zIndex: 1200\n      },\n      children: \"Log out\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), Layout && /*#__PURE__*/_jsxDEV(Layout, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 18\n    }, this), /*#__PURE__*/_jsxDEV(SettingsModal, {\n      open: settingsOpen,\n      onClose: () => setSettingsOpen(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(AppInner, \"1HXz6d0JI/9A/kqTpg21FHXUVhM=\", false, function () {\n  return [useAuth];\n});\n_c2 = AppInner;\nvar _c, _c2;\n$RefreshReg$(_c, \"App\");\n$RefreshReg$(_c2, \"AppInner\");","map":{"version":3,"names":["React","useEffect","useState","AuthProvider","useAuth","Login","SettingsModal","jsxDEV","_jsxDEV","Fragment","_Fragment","App","children","AppInner","fileName","_jsxFileName","lineNumber","columnNumber","_c","_s","currentUser","logout","Layout","setLayout","settingsOpen","setSettingsOpen","resetMap","window","__legacyMapInstance","remove","__legacyMapInit","el","document","getElementById","innerHTML","handleLogout","body","classList","role","add","then","m","default","tick","setInterval","mapboxgl","__mapboxPatchApplied","OriginalMap","Map","args","inst","prototype","Object","setPrototypeOf","clearInterval","legacy","assign","initializeMap","setTimeout","dispatchEvent","Event","id","onClick","style","position","top","right","zIndex","open","onClose","_c2","$RefreshReg$"],"sources":["/Users/isakhan/Documents/MapboxProject/frontend/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { AuthProvider, useAuth } from './auth/AuthContext';\nimport Login from './components/Login';\nimport SettingsModal from './components/SettingsModal';\nimport './legacy/indexLegacy.css';\n\n/* Root wrapper so auth is global */\nexport default function App() {\n  return (\n    <AuthProvider>\n      <AppInner />\n    </AuthProvider>\n  );\n}\n\nfunction AppInner() {\n  const { currentUser, logout } = useAuth();\n  const [Layout, setLayout] = useState(null);\n  const [settingsOpen, setSettingsOpen] = useState(false);\n\n  // Completely clean the previous Mapbox instance so re-login works without refresh\n  const resetMap = () => {\n    try {\n      if (\n        window.__legacyMapInstance &&\n        typeof window.__legacyMapInstance.remove === 'function'\n      ) {\n        window.__legacyMapInstance.remove();\n      }\n    } catch {}\n    window.__legacyMapInstance = null;\n    window.__legacyMapInit = false;\n    const el = document.getElementById('map');\n    if (el) el.innerHTML = '';\n  };\n\n  const handleLogout = () => {\n    resetMap();\n    logout();\n  };\n\n  // Role class (hides graph buttons for non-admin via CSS)\n  useEffect(() => {\n    document.body.classList.remove('role-admin', 'role-user');\n    if (currentUser?.role === 'admin')\n      document.body.classList.add('role-admin');\n    if (currentUser?.role === 'user') document.body.classList.add('role-user');\n  }, [currentUser]);\n\n  // Mount/unmount legacy layout around auth changes\n  useEffect(() => {\n    if (!currentUser) {\n      setLayout(null);\n      resetMap();\n      return;\n    }\n    import('./components/LegacyLayout').then((m) => setLayout(() => m.default));\n  }, [currentUser]);\n\n  // Initialize the legacy map exactly once per login (StrictMode-safe)\n  useEffect(() => {\n    if (!currentUser || !Layout) return;\n\n    resetMap(); // ensure clean slate before init\n\n    let tick = setInterval(async () => {\n      if (!window.mapboxgl || !document.getElementById('map')) return;\n\n      // Patch Map constructor once so we can track/remove the live instance\n      if (!window.__mapboxPatchApplied) {\n        const OriginalMap = window.mapboxgl.Map;\n        window.mapboxgl.Map = function (...args) {\n          const inst = new OriginalMap(...args);\n          window.__legacyMapInstance = inst;\n          return inst;\n        };\n        window.mapboxgl.Map.prototype = OriginalMap.prototype;\n        Object.setPrototypeOf(window.mapboxgl.Map, OriginalMap);\n        window.__mapboxPatchApplied = true;\n      }\n\n      if (window.__legacyMapInit) {\n        clearInterval(tick);\n        return;\n      }\n\n      const legacy = await import('./legacy/indexLegacy');\n      Object.assign(window, legacy); // expose your original functions\n      window.__legacyMapInit = true; // guard against double init\n      legacy.initializeMap(); // call your original entry point\n      setTimeout(() => window.dispatchEvent(new Event('resize')), 0);\n      clearInterval(tick);\n    }, 50);\n\n    return () => clearInterval(tick);\n  }, [currentUser, Layout]);\n\n  if (!currentUser) return <Login />;\n\n  return (\n    <>\n      <button id=\"settingsBtn\" onClick={() => setSettingsOpen(true)}>\n        Settings\n      </button>\n      <button\n        id=\"logoutBtn\"\n        onClick={handleLogout}\n        style={{ position: 'fixed', top: 12, right: 112, zIndex: 1200 }}\n      >\n        Log out\n      </button>\n\n      {Layout && <Layout />}\n\n      <SettingsModal\n        open={settingsOpen}\n        onClose={() => setSettingsOpen(false)}\n      />\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}